(()=>{"use strict";var e,t=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},n=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")};function r(e,r){var o=Array.from(e.querySelectorAll(r.inputSelector)),c=e.querySelector(r.submitButtonSelector);n(o,c,r.inactiveButtonClass),o.forEach((function(n){t(e,n,r)}))}function o(e,t,n,r,o,c,a,l,i,u,s,d){var f=e.querySelector(o.elementSelector).cloneNode(!0);f.dataset.id=i;var m=f.querySelector(o.elementPictureSelector);m.src=n,m.alt=t,m.addEventListener("click",(function(){c(t,n)}));var v=f.querySelector(o.elementLikeCountSelector),p=f.querySelector(o.elementHeartSelector);v.textContent=r,f.querySelector(o.elementTitleSelector).textContent=t,p.addEventListener("click",(function(e){e.target.classList.contains(o.elementHeartActiveClass)?(e.target.classList.remove(o.elementHeartActiveClass),u(i).then((function(e){v.textContent=e}))):(e.target.classList.add(o.elementHeartActiveClass),s(i).then((function(e){v.textContent=e})))}));var h=f.querySelector(o.elementTrashSelector);return h.addEventListener("click",(function(e){l(i)})),a&&h.classList.add(o.elementTrashAvailable),d&&p.classList.add(o.elementHeartActiveClass),f}function c(t){"Escape"===t.key&&l(e)}function a(t,n){e=n,t.classList.add(n),document.addEventListener("keydown",c)}function l(e){var t=document.querySelector("."+e);t&&t.classList.remove(e),document.removeEventListener("keydown",c)}var i={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"74327f87-7f6a-45e4-8ce4-149141926891","Content-Type":"application/json"}},u=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function s(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(u).then((function(e){return e.likes.length})).catch((function(e){console.log(e)}))}function d(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(u).then((function(e){return e.likes.length})).catch((function(e){console.log(e)}))}var f,m,v,p={elementSelector:".element",elementPictureSelector:".element__picture",elementTitleSelector:".element__title",elementHeartSelector:".element__heart",elementHeartActiveClass:"element__heart_active",elementTrashSelector:".element__trash",elementLikeCountSelector:".element__like-count",elementTrashAvailable:"element__trash_avaliable"},h={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},_="popup_opened",S=document.querySelector("#popupProfile"),y=S.querySelector(".form"),q=y.querySelector(".form__submit"),b=S.querySelector(".form__input-container"),E=b.querySelector('[name="name-input"]'),L=b.querySelector('[name="description"]'),C=document.querySelector("#popupImage"),g=C.querySelector(".popup__image-container"),k=g.querySelector(".popup__image"),A=g.querySelector(".popup__title"),T=document.querySelector("#popupAddCard"),x=T.querySelector(".form"),U=x.querySelector(".form__submit"),H=T.querySelector('.form__input[name="element-title"]'),P=T.querySelector('.form__input[name="link"]'),D=document.querySelector(".elements__list"),B=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),O=document.querySelector(".profile__avatar"),j=document.querySelector(".profile__avatar-edit"),w=document.querySelector(".profile__edit-button"),J=document.querySelector("#popupConfirm"),G=J.querySelector(".form"),z=document.querySelector("#popupEditAvatar"),I=z.querySelector(".form"),M=I.querySelector(".form__submit"),F=I.querySelector('.form__input[name="link"]');function K(e,t,n){B.textContent=e,N.textContent=t,O.src=n}function Q(e){O.src=e}O.addEventListener("mouseover",(function(){j.classList.add("profile__avatar-edit_active")})),j.addEventListener("mouseout",(function(){j.classList.remove("profile__avatar-edit_active")})),j.addEventListener("click",(function(){F.value="",r(I,h),a(z,_)})),I.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M.value="Сохранение...",(t=F.value,n=Q,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(u).then((function(e){n(e.avatar)})).catch((function(e){console.log(e)}))).finally((function(){l(_),M.value="Сохранить"}))})),(v=K,fetch("".concat(i.baseUrl,"/users/me"),{method:"GET",headers:i.headers}).then(u).then((function(e){return v(e.name,e.about,e.avatar),e._id})).catch((function(e){console.log(e)}))).then((function(e){f=e,console.log(f),function(e,t){fetch("".concat(i.baseUrl,"/cards"),{method:"GET",headers:i.headers}).then(u).then((function(n){console.log(n),n.forEach((function(n){var r=t===n.owner._id,o=!1;n.likes.forEach((function(e){e._id===t&&(o=!0)})),e(n.name,n.link,n.likes.length,r,n._id,o)}))})).catch((function(e){console.log(e)}))}(Z,f)})),w.addEventListener("click",(function(){E.value=B.textContent,L.value=N.textContent,r(y,h),a(S,_)})),y.addEventListener("submit",(function(e){e.preventDefault(),q.value="Сохранение...",function(e,t,n){return fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(u).then((function(e){n(e.name,e.about,e.avatar)})).catch((function(e){console.log(e)}))}(E.value,L.value,K).finally((function(){l(_),q.value="Сохранить"}))})),G.addEventListener("submit",(function(e){var t;e.preventDefault(),console.log(m),(t=m,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).catch((function(e){console.log(e)}))).then((function(){!function(e){document.querySelector('[data-id="'.concat(e,'"]')).remove()}(m)})),l(_)}));var R,V=document.querySelector("#templateElement").content,W=function(e,t){k.src=t,k.alt=e,A.textContent=e,a(C,_)},X=function(e){a(J,_),m=e};function Y(e,t,n,r,c,a){var l=o(V,e,t,n,p,W,r,X,c,d,s,a);D.prepend(l)}function Z(e,t,n,r,c,a){var l=o(V,e,t,n,p,W,r,X,c,d,s,a);D.append(l)}document.querySelector(".profile__add-button").addEventListener("click",(function(){H.value="",P.value="",r(x,h),a(T,_)})),x.addEventListener("submit",(function(e){var t,n,r;e.preventDefault(),U.value="Сохранение...",(t=H.value,n=P.value,r=Y,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:n})}).then(u).then((function(e){r(e.name,e.link,e.likes.length,!0,e._id)})).catch((function(e){console.log(e)}))).finally((function(){l(_),U.value="Сохранить"}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&l(_),e.target.classList.contains("popup__close")&&l(_)}))})),R=h,Array.from(document.querySelectorAll(R.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),r(e,R),function(e,r){var o=Array.from(e.querySelectorAll(r.inputSelector)),c=e.querySelector(r.submitButtonSelector);o.forEach((function(a){a.addEventListener("input",(function(){!function(e,n,r){n.validity.valid?t(e,n,r):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,n,n.validationMessage,r)}(e,a,r),n(o,c,r.inactiveButtonClass)}))}))}(e,R)}))})();